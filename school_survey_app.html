<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026학년도 사하중학교 교육계획 수립 설문조사</title>
    <!-- Tailwind CSS (디자인 프레임워크) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 폰트: Noto Sans KR -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .scale-radio:checked + label { background-color: #3B82F6; color: white; border-color: #3B82F6; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- 메인 컨테이너 -->
    <div class="max-w-3xl mx-auto py-10 px-4">
        
        <!-- 헤더 -->
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">2026학년도 교육계획 수립을 위한 설문조사</h1>
            <p class="text-gray-600">사하중학교 교육 가족 여러분의 소중한 의견을 듣습니다.</p>
        </header>

        <!-- 1단계: 대상 선택 화면 -->
        <div id="step-selection" class="bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">참여 대상을 선택해주세요</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="startSurvey('teacher')" class="p-6 border-2 border-blue-100 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition flex flex-col items-center gap-3 group">
                    <span class="text-4xl">🧑‍🏫</span>
                    <span class="font-bold text-gray-700 group-hover:text-blue-600">교사</span>
                </button>
                <button onclick="startSurvey('student')" class="p-6 border-2 border-green-100 rounded-lg hover:border-green-500 hover:bg-green-50 transition flex flex-col items-center gap-3 group">
                    <span class="text-4xl">🧑‍🎓</span>
                    <span class="font-bold text-gray-700 group-hover:text-green-600">학생</span>
                </button>
                <button onclick="startSurvey('parent')" class="p-6 border-2 border-purple-100 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition flex flex-col items-center gap-3 group">
                    <span class="text-4xl">👨‍👩‍👧‍👦</span>
                    <span class="font-bold text-gray-700 group-hover:text-purple-600">보호자</span>
                </button>
            </div>
        </div>

        <!-- 2단계: 설문 폼 화면 (동적 생성) -->
        <div id="step-form" class="hidden bg-white p-8 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h2 id="form-title" class="text-xl font-bold text-blue-800">설문조사</h2>
                <button onclick="goBack()" class="text-gray-500 hover:text-gray-700 text-sm">← 처음으로</button>
            </div>
            
            <form id="surveyForm" onsubmit="submitForm(event)">
                <!-- 설문 문항들이 여기에 JavaScript로 삽입됩니다 -->
                <div id="questions-container" class="space-y-8"></div>

                <div class="mt-10 pt-6 border-t flex justify-center">
                    <button type="submit" id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-lg shadow-md transition transform hover:scale-105">
                        제출하기
                    </button>
                </div>
            </form>
        </div>

        <!-- 3단계: 완료 화면 -->
        <div id="step-complete" class="hidden bg-white p-12 rounded-xl shadow-lg text-center">
            <div class="text-6xl mb-4">✅</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">제출이 완료되었습니다</h2>
            <p class="text-gray-600 mb-8">소중한 의견 감사합니다.</p>
            <button onclick="location.reload()" class="text-blue-600 hover:underline">돌아가기</button>
        </div>
        
        <!-- 로딩 오버레이 -->
        <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
            <div class="bg-white p-5 rounded-lg flex items-center gap-3">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                <span>제출 중입니다...</span>
            </div>
        </div>

    </div>

    <!-- JavaScript 로직 -->
    <script>
        // *** 중요: 배포 후 생성된 Web App URL을 이곳에 입력해야 합니다 ***
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzpUNlysYVgZsJsHQ5gYRyJTQwj5yuDECqBICaNCffZZX97EdAY3gatP6w6wt7rnogWGg/exec"; 

        // 설문 데이터 (PDF 기반 재구성)
        const surveyData = {
            teacher: {
                title: "교사용 설문 (2025 평가 및 2026 계획)",
                questions: [
                    // 섹션 1: 5점 척도형
                    { type: 'section', title: '2025학년도 교육활동 평가' },
                    { id: 't_q1', type: 'scale', text: '(교육과정) 교육과정에 따라 각종 교육활동이 효과적으로 운영되고 있다.' },
                    { id: 't_q2', type: 'scale', text: '(특색사업) "함께 읽고 모두 다 꿈꾸다" 운영에 대한 만족도가 높다.' },
                    { id: 't_q3', type: 'scale', text: '(학력신장) 기초학력 보장 및 자기주도 학습능력 신장 활동이 도움이 되고 있다.' },
                    { id: 't_q4', type: 'scale', text: '(자유학기제) 자유학기제가 취지에 맞게 내실 있게 운영되고 있다.' },
                    { id: 't_q5', type: 'scale', text: '(생활지도) 생활지도 및 인성지도가 일관되게 이루어지고 있다.' },
                    { id: 't_q6', type: 'scale', text: '(학교문화) 의사 결정 과정에 교직원 참여도가 높고 의견이 잘 반영된다.' },
                    
                    // 섹션 2: 선택형/서술형
                    { type: 'section', title: '2026학년도 교육계획 수립' },
                    { id: 't_plan_1', type: 'radio', text: '창의적 체험활동 운영 시 가장 중점을 두어야 할 부분은?', options: ['자율활동', '동아리활동(일반)', '동아리활동(예술/스포츠)', '봉사활동', '진로활동'] },
                    { id: 't_plan_2', type: 'radio', text: '선생님의 교육활동 중 가장 중점을 두는 영역은?', options: ['기본 학습태도 훈련', '교과 지도', '생활지도', '인성교육', '특기적성 교육', '기타'] },
                    { id: 't_plan_3', type: 'radio', text: '학교폭력 근절을 위한 가장 시급한 대책은?', options: ['학교 주변 정화', '교사 순회 지도', '체계적 인성 교육', '폭력학생 엄벌', '담임 책임 지도', '기타'] },
                    { id: 't_plan_4', type: 'radio', text: '교원 업무 경감을 위해 우선적으로 실시해야 하는 것은?', options: ['행정 업무 간소화', '문서 관리 효율화', '업무의 효율적 배분', '인력 충원', '기타'] },
                    { id: 't_opinion', type: 'text', text: '2026학년도에 추진하기를 원하는 사업이나 건의사항을 자유롭게 적어주세요.' }
                ]
            },
            student: {
                title: "학생용 설문 (2025 평가 및 2026 계획)",
                questions: [
                    { type: 'section', title: '2025학년도 교육활동 평가' },
                    { id: 's_q1', type: 'scale', text: '(교사의 노력) 선생님들의 수업 준비 및 노력에 대해 만족한다.' },
                    { id: 's_q2', type: 'scale', text: '(수업 개선) 공개수업 등은 수업 개선에 도움이 된다.' },
                    { id: 's_q3', type: 'scale', text: '(체험활동) 현장체험, 동아리, 학예제 등이 알차게 운영되고 있다.' },
                    { id: 's_q4', type: 'scale', text: '(생활지도) 교문지도, 생활습관 지도 등이 일관되게 이루어진다.' },
                    { id: 's_q5', type: 'scale', text: '(급식) 학교 급식이 안전하고 위생적이며 맛있다.' },

                    { type: 'section', title: '2026학년도 교육계획 수립' },
                    { id: 's_plan_1', type: 'radio', text: '우리 학교에 대해 자부심을 가지는 점은?', options: ['참신한 교육활동', '좋은 시설/환경', '학생들의 바른 태도', '친절한 행정', '기타'] },
                    { id: 's_plan_2', type: 'radio', text: '학교에서 더 관심을 가져주길 바라는 분야는?', options: ['교과교육', '생활/인성지도', '특기적성', '진로교육', '독서교육', '예술체육', '기타'] },
                    { id: 's_plan_3', type: 'radio', text: '배우고 싶은 선택 과목은?', options: ['보건', '시사토론', '과제탐구', '환경', '생활외국어'] },
                    { id: 's_opinion', type: 'text', text: '우리 학교의 자랑거리나 건의사항을 적어주세요.' }
                ]
            },
            parent: {
                title: "보호자용 설문 (2025 평가 및 2026 계획)",
                questions: [
                    { type: 'section', title: '2025학년도 교육활동 평가' },
                    { id: 'p_q1', type: 'scale', text: '(교육과정) 학교 교육과정 운영 전반에 만족한다.' },
                    { id: 'p_q2', type: 'scale', text: '(학부모 참여) 학교설명회, 수업공개 등이 신뢰 형성에 도움이 된다.' },
                    { id: 'p_q3', type: 'scale', text: '(생활지도) 학교폭력 예방 및 생활지도가 잘 이루어지고 있다.' },
                    { id: 'p_q4', type: 'scale', text: '(방과후) 방과후학교가 사교육비 경감 및 특기 신장에 기여한다.' },
                    { id: 'p_q5', type: 'scale', text: '(소통) 학교와 가정 간의 소통이 원활하다.' },

                    { type: 'section', title: '2026학년도 교육계획 수립' },
                    { id: 'p_plan_1', type: 'radio', text: '학교 교육에서 가장 중점을 두어야 할 부분은?', options: ['교과교육', '생활/인성지도', '특기적성', '진로교육', '독서/체육/문화', '기타'] },
                    { id: 'p_plan_2', type: 'radio', text: '자녀 학력향상을 위해 바라는 점은?', options: ['수업 질 향상', '방과후 확대', '도서관 개방 연장', '관련 대회 추진', '기타'] },
                    { id: 'p_plan_3', type: 'radio', text: '학교폭력 근절을 위한 시급한 대책은?', options: ['주변 환경 정화', '순회 지도 강화', '인성 교육', '엄벌 및 조치', '상담 운영', '기타'] },
                    { id: 'p_opinion', type: 'text', text: '학교 교육활동에 대하여 바라는 점을 자유롭게 적어주세요.' }
                ]
            }
        };

        let currentRole = '';

        function startSurvey(role) {
            currentRole = role;
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-form').classList.remove('hidden');
            document.getElementById('form-title').innerText = surveyData[role].title;
            renderQuestions(role);
        }

        function goBack() {
            if(confirm('작성 중인 내용이 초기화됩니다. 돌아가시겠습니까?')) {
                document.getElementById('step-form').classList.add('hidden');
                document.getElementById('step-selection').classList.remove('hidden');
                document.getElementById('questions-container').innerHTML = '';
            }
        }

        function renderQuestions(role) {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            const questions = surveyData[role].questions;

            questions.forEach((q, index) => {
                let html = '';
                
                if (q.type === 'section') {
                    html = `<h3 class="text-lg font-bold text-gray-800 border-l-4 border-blue-500 pl-3 mt-8">${q.title}</h3>`;
                } else if (q.type === 'scale') {
                    html = `
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <p class="font-medium text-gray-800 mb-4"><span class="text-blue-600 mr-2">Q.</span>${q.text}</p>
                            <div class="flex flex-wrap justify-between gap-2">
                                ${[1, 2, 3, 4, 5].map(score => {
                                    const labels = ['전혀 아님', '별로 아님', '보통', '대체로', '매우 그렇다'];
                                    return `
                                    <div class="flex-1 min-w-[60px]">
                                        <input type="radio" name="${q.id}" id="${q.id}_${score}" value="${score}" class="scale-radio hidden" required>
                                        <label for="${q.id}_${score}" class="block text-center p-3 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-100 transition text-sm">
                                            <div class="font-bold text-lg mb-1">${score}</div>
                                            <div class="text-xs text-gray-500">${labels[score-1]}</div>
                                        </label>
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                } else if (q.type === 'radio') {
                    html = `
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <p class="font-medium text-gray-800 mb-4"><span class="text-blue-600 mr-2">Q.</span>${q.text}</p>
                            <div class="space-y-2">
                                ${q.options.map((opt, i) => `
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 bg-white cursor-pointer hover:bg-blue-50">
                                        <input type="radio" name="${q.id}" value="${opt}" class="w-4 h-4 text-blue-600" required>
                                        <span class="ml-3 text-gray-700">${opt}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (q.type === 'text') {
                    html = `
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <p class="font-medium text-gray-800 mb-4"><span class="text-blue-600 mr-2">Q.</span>${q.text}</p>
                            <textarea name="${q.id}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" rows="4" placeholder="내용을 입력해주세요..."></textarea>
                        </div>
                    `;
                }
                
                container.innerHTML += html;
            });
            
            // role 정보를 숨겨진 필드로 추가하지 않고 submit 시 함께 전송
        }

        function submitForm(event) {
            event.preventDefault();
            
            // 데모 모드 (URL이 설정되지 않았을 때)
            if (GOOGLE_SCRIPT_URL === "YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE") {
                alert("이것은 미리보기 화면입니다.\n실제 데이터를 저장하려면 [Deployment_Guide.md]를 참고하여\nGoogle Apps Script를 배포하고 URL을 설정해야 합니다.");
                
                // UI 전환 시뮬레이션
                document.getElementById('step-form').classList.add('hidden');
                document.getElementById('step-complete').classList.remove('hidden');
                return;
            }

            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');

            const formData = new FormData(event.target);
            const data = { role: currentRole, timestamp: new Date().toISOString() };
            
            formData.forEach((value, key) => {
                data[key] = value;
            });

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Google Apps Script Web App 특성상 no-cors 필요
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                loading.classList.add('hidden');
                document.getElementById('step-form').classList.add('hidden');
                document.getElementById('step-complete').classList.remove('hidden');
            })
            .catch(error => {
                loading.classList.add('hidden');
                alert("제출 중 오류가 발생했습니다. 다시 시도해주세요.");
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
